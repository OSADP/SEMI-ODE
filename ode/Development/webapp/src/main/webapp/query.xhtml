<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>ODE Query</title>
<style type="text/css">
body {
   background-color: #FFFFCC
}

h1 {
   color: #3366FF
}

h2 {
   color: #6699FF
}

#controls-container {
   float: left;
   width: 1500px
}

#controls-container div {
   padding: 5px;
}

#left-container {
   float: left;
   width: 400px
}

#left-container div {
   padding: 5px;
}

#middle-container {
   float: left;
   width: 400px
}

#middle-container div {
   padding: 5px;
}

#right-container {
   float: left;
   width: 400px
}

#right-container div {
   padding: 5px;
}

#console-container {
   float: left;
   margin-left: 15px;
   width: 1200px;
}

#console {
   border: 1px solid #CCCCCC;
   border-right-color: #999999;
   border-bottom-color: #999999;
   height: 200px;
   overflow-y: scroll;
   padding: 5px;
   width: 100%;
}

#console p {
   padding: 0;
   margin: 0;
}
</style>
<script type="application/javascript">
   
   <![CDATA[
              "use strict";
      
              var ws = null;
              var started = false;
              var connected = false;
      
              function setConnectionState(c, s) {
                  connected = c;
                  started = s;
                  
                  if (!connected)
                     started = false;
                  
                  document.getElementById('connect').disabled = connected;
                  document.getElementById('disconnect').disabled = !connected;
                  document.getElementById('start').disabled = (started || !connected);
              }
      
              function connect() {
                  var requestUri = document.getElementById('requestUri').value;
                  if (requestUri == '') {
                      alert('Please select server side connection implementation.');
                      return;
                  }
                  if ('WebSocket' in window) {
                      ws = new WebSocket(requestUri);
                  } else if ('MozWebSocket' in window) {
                      ws = new MozWebSocket(requestUri);
                  } else {
                      alert('WebSocket is not supported by this browser.');
                      return;
                  }
                  ws.onopen = function (event) {
                      setConnectionState(true, false);
                      log('Info: WebSocket connection opened.');
                  };
                  ws.onmessage = function (event) {
                     if (!started) {
                           var message = JSON.parse(event.data);
                           if (message["code"] != "SUCCESS") {
                               setConnectionState(true, true);
                           }
                     }
                  
                     log(event.data);
                  };
                  ws.onclose = function (event) {
                      setConnectionState(false, false);
                      log('Info: WebSocket connection closed, Code: ' + event.code + (event.reason == "" ? "" : ", Reason: " + event.reason));
                  };
              }
      
              function disconnect() {
                  if (ws != null) {
                      ws.close();
                      ws = null;
                  }
                  setConnectionState(false, false);
              }
      
              function start() {
                  if (ws != null) {
                     var request = {};
                     request["nwLat"] = document.getElementById('nwLat').value;
                     request["nwLon"] = document.getElementById('nwLon').value;
                     request["seLat"] = document.getElementById('seLat').value;
                     request["seLon"] = document.getElementById('seLon').value;
                     request["startDate"] = document.getElementById('startDate').value;
                     request["endDate"] = document.getElementById('endDate').value;
                     var reqStr = JSON.stringify(request); 
                      ws.send(reqStr);
                      log('Sent: ' +  reqStr);
                  } else {
                      alert('WebSocket connection not established, please connect.');
                  }
              }
      
              function updateRequestUri(requestUri) {
                  if (window.location.protocol == 'http:') {
                      document.getElementById('requestUri').value = 'ws://' + window.location.host + requestUri;
                  } else {
                      document.getElementById('requestUri').value = 'wss://' + window.location.host + requestUri;
                  }
                  setConnectionState(false, false);
                  
                  var now = new Date();
                  var yesterday = new Date();
                  yesterday.setDate(now.getDate()-1);

                  document.getElementById('startDate').value = yesterday.toISOString();
                  document.getElementById('endDate').value = now.toISOString();
              }
      
              function log(msgOrData) {
                  var console = document.getElementById('console');
                  var p = document.createElement('p');
                  p.style.wordWrap = 'break-word';
                  p.appendChild(document.createTextNode(msgOrData));
                  console.appendChild(p);
                  while (console.childNodes.length > 25) {
                      console.removeChild(console.firstChild);
                  }
                  console.scrollTop = console.scrollHeight;
              }
      
      
              document.addEventListener("DOMContentLoaded", function() {
                  // Remove elements with "noscript" class - <noscript> is not allowed in XHTML
                  var noscripts = document.getElementsByClassName("noscript");
                  for (var i = 0; i < noscripts.length; i++) {
                      noscripts[i].parentNode.removeChild(noscripts[i]);
                  }
              }, false);
          ]]>
      

</script>
</head>
<body>
   <h1>ODE Query</h1>
   <div class="noscript">
      <h2 style="color: #ff0000">Seems your browser doesn't support
         Javascript! Websockets rely on Javascript being enabled. Please
         enable Javascript and reload this page!</h2>
   </div>
   <div id="controls-container">
      <div id="left-container">
         <div id="selectData">
            <hr />
            <h2>Select Data:</h2>
            <input id="vsd" type="radio" name="group1" value="/ode/api/ws/qry/veh" onclick="updateRequestUri(this.value);" />
            <label for="vsd">Vehicles</label> <br />
            
            <input id="isd" type="radio" name="group1" value="/ode/api/ws/qry/int" onclick="updateRequestUri(this.value);" />
            <label for="isd">Intersections</label><br />
            
            <input id="adv" type="radio" name="group1" value="/ode/api/ws/qry/adv" onclick="updateRequestUri(this.value);" />
            <label for="adv">Advisory Messages</label> <br />
            
            <input id="requestUri" type="text" size="40" style="width: 350px" />
            <h2>Enter Time Period</h2>
            <label>Start Date</label> <input id="startDate" type="text" value = "yyyy-MM-ddTHH:mm:ss" size="40" style="width: 350px" /><br />
            <label>End Date</label> <input id="endDate" type="text" value = "yyyy-MM-ddTHH:mm:ss" size="40" style="width: 350px" /><br />
         </div>
      </div>
      <div id="middle-container">
         <div id="geoRegion">
            <hr />
            <h2>Enter Geographic Region</h2>
            <br />
            <label>NW Latitude</label> <input id="nwLat" type="text" value = "43.652969118285434" size="40" style="width: 350px" /><br />
            <label>NW Longitude</label> <input id="nwLon" type="text" value = "-85.94707489013672" size="40" style="width: 350px" /><br />
            <label>SE Latitude</label> <input id="seLat" type="text" value = "36.4765153148293" size="40" style="width: 350px" /><br />
            <label>SE Longitude</label> <input id="seLon" type="text" value = "-74.53468322753906" size="40" style="width: 350px" /><br />
         </div>
      </div>
      <div id="right-container">
         <!-- 
            <div id="selectFormat">
               <hr/>
               <h2>Select Format:</h2><br/>
               <input id="json" type="radio" name="group2" value="json"/>
               <label for="json">JSON</label>
               <input id="hex" type="radio" name="group2" value="hex"/>
               <label for="hex">Hex</label>
               <input id="base64" type="radio" name="group2" value="base64"/>
               <label for="vsd">Base 64</label>
               <br/>
            </div>
         -->
         <div id="destination">
            <hr />
            <h2>Destination:</h2><br />
            <input id="screen" type="checkbox" checked="checked" value="screen" />
              <label for="screen">On Screen</label><br />
            <input id="file" type="checkbox" value="file" />
              <label for="file">Server File Path</label><br />
            <a href="https://ode/download/">https://ode/download/</a><br />
            <br />
         </div>
      </div>
   </div>
   <div id="console-container">
      <div>
         <hr />
         <button id="connect" disabled="disabled" onclick="connect();">Connect</button>
         <button id="start" disabled="disabled" onclick="start();">Start</button>
         <button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
      </div>
      <hr />
      <div id="console" />
   </div>
</body>
</html>